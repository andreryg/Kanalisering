<!doctype html>
<html>
    <head>
        <title>Kanalisering</title>
        <link rel="stylesheet" href="viewer.css">
    </head>
    <body>
        <div class=upper>
            <div class=first>
                <button onclick = "Open();">Neste</button>
                <button onclick = "Save()">Lagre</button>
                <button onclick = "ClearStorage();">Clear local storage</button>
            </div>
            <div class=second>
                <label for="armer">Armer i rundkj√∏ring:</label>
                <input type="number" name="armerverdi" id="armverdi" min="1" max="8" onkeyup="if(parseInt(this.value)>8){this.value = 8;} else if(parseInt(this.value)<1){this.value = 1;}" autofocus>
            </div>
        </div>
        <div class=lower>
            <iframe id="Kart" width="100%" height="100%" bottom="0"></iframe>
        </div>
        <script src="koordinater.js"></script>
        <script type = "text/javascript">            
            let i = localStorage.getItem("i") ? Number(localStorage.getItem("i")) : 0;
            var link = `https://vegkart.atlas.vegvesen.no/#kartlag:nib/@${koordinater[i][0]},${koordinater[i][1]},16/hva:!(id~49)~/valgt:${koordinater[i][2]}:37~/vegnett:metrering~+(detaljniva~!VT)~`;
            const Kart = document.getElementById("Kart");
            
            Kart.src = link
            
            k2 = document.getElementById("armverdi")
            //console.log(kanalisering)
            

            function ClearStorage() {
                console.log("Cleared")
                window.localStorage.clear();
                location.reload()
            }
            function Open() {
                if (k2.value != "") {
                    var armer = localStorage.getItem("armer") ? JSON.parse(localStorage.getItem("armer")) : []
                    armer.push([koordinater[i][2], k2.value])
                    localStorage.setItem("armer", JSON.stringify(armer))
                    console.log(armer)
                    
                    ++i;
                    localStorage.setItem("i", i)
                    console.log(i)
                
                    link = `https://vegkart.atlas.vegvesen.no/#kartlag:nib/@${koordinater[i][0]},${koordinater[i][1]},16/hva:!(id~49)~/valgt:${koordinater[i][2]}:37~/vegnett:metrering~+(detaljniva~!VT)~`;
                    Kart.src = link
                    location.reload()
                    
                }
            }
            var input = document.getElementById("armverdi");
            input.addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    event.preventDefault();
                    Open();
                }
            })
            function Save() {
                var armer = localStorage.getItem("armer") ? JSON.parse(localStorage.getItem("armer")) : []
                const link = document.createElement("a")
                const file = new Blob([JSON.stringify(armer)], { type: 'text/plain' })
                link.href = URL.createObjectURL(file)
                link.download = "armer.txt"
                link.click()
                URL.revokeObjectURL(link.href)
            }
            window.addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    document.getElementById("armverdi").focus();
                }
            })
        </script>
    </body>
</html>